{% extends "base.html" %}

{% block extra_css %}
    <style>
        label.form-label.required::after {
            content: " *";
            color: red;
        }
        .progress-icon{
                z-index: 1; 
                background: white; 
                padding: 0 10px;
            }
        .progress-icon-inner{
            width: 40px;
            height: 40px;
        }
        @media (max-width: 560px) {
            .card-control{
                padding: 10px 5px;
                height: 90px;
            }
            .progress-icon{
                padding: 0 0px;
            }
            .progress-icon-inner{
            width: 25px;
            height: 25px;
        }
        .progress-icon-text{
            font-size: 9px;
        }
        }
    </style>
{% endblock %}

{% block title %}Submit New Complaint - UAV Support Portal{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="row mb-4">
    <div class="col">
        <h2 class="mb-0">Submit New Complaint</h2>
        <p class="text-muted">Report an issue with your UAV for support assistance</p>
    </div>
    <div class="col-auto">
        <button type="button" class="btn btn-outline-secondary" onclick="history.back()">
            <i class="fas fa-arrow-left me-2"></i>Back to Complaints
        </button>
    </div>

</div>

<!-- Progress Steps -->
<div class="card mb-4 sticky-top" style="z-index: 1000; top:65px; background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
    <div class="card-body card-control">
        <div class="d-flex justify-content-between position-relative">
            <div class="progress position-absolute" style="width: 100%; height: 2px; top: 50%; transform: translateY(-50%); z-index: 0;">
                <div class="progress-bar" role="progressbar" style="width: 0%" id="formProgress"></div>
            </div>
            <div class="step active text-center position-relative progress-icon">
                <div class="step-icon rounded-circle bg-primary text-white d-inline-flex align-items-center justify-content-center mb-2 progress-icon-inner">
                    <i class="fas fa-user"></i>
                </div>
                <div class="step-label small progress-icon-text">Pilot Info</div>
            </div>
            <div class="step text-center position-relative progress-icon">
                <div class="step-icon rounded-circle bg-light d-inline-flex align-items-center justify-content-center mb-2 progress-icon-inner">
                    <i class="fas fa-plane"></i>
                </div>
                <div class="step-label small progress-icon-text">UAV Details</div>
            </div>
            <div class="step text-center position-relative progress-icon">
                <div class="step-icon rounded-circle bg-light d-inline-flex align-items-center justify-content-center mb-2 progress-icon-inner">
                    <i class="fas fa-cloud"></i>
                </div>
                <div class="step-label small progress-icon-text">Conditions</div>
            </div>
            <div class="step text-center position-relative progress-icon">
                <div class="step-icon rounded-circle bg-light d-inline-flex align-items-center justify-content-center mb-2 progress-icon-inner">
                    <i class="fas fa-file-pen"></i> 
                </div>
                <div class="step-label small progress-icon-text">Description</div>
            </div>
            <div class="step text-center position-relative progress-icon">
                <div class="step-icon rounded-circle bg-light d-inline-flex align-items-center justify-content-center mb-2 progress-icon-inner">
                    <i class="fas fa-file-alt"></i>
                </div>
                <div class="step-label small progress-icon-text">Upload Files</div>
            </div>
        </div>
    </div>
</div>

<form method="post" action="{% if is_valid %} {% url 'complaint_edit' event.id %} {% else %}{% url 'complain_submit' %}{% endif %}" enctype="multipart/form-data" id="complaintForm" >
        {% csrf_token %}
        
        <!-- Pilot Information Card -->
        <div class="card mb-4" id="pilotInfo">
            <div class="card-header bg-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-user-pilot me-2"></i>Pilot Information
                </h5>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="pilotName" class="form-label required">Pilot Name</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-user"></i></span>
                            <input type="text" class="form-control" id="pilotName" name="pilot_name" value="{{ event.pilot_name|default:'' }}" placeholder="Enter pilot name" {% if is_readonly %}disabled{% endif %} required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label for="emailAddress" class="form-label required">Email Address</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                            <input type="email" class="form-control" id="emailAddress" name="email" value="{{ event.email|default:'' }}" placeholder="name@example.com" {% if is_readonly %}disabled{% endif %} required>
                        </div>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="certificateNumber" class="form-label">Certificate Number</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-certificate"></i></span>
                            <input type="text" class="form-control" id="certificateNumber" name="certificate_number" placeholder="Enter drone flying certificate number" value="{{ event.certificate_number|default:'' }}" {% if is_readonly %}disabled{% endif %}>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label for="designation" class="form-label required">Designation</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-id-badge"></i></span>
                            <input type="text" class="form-control" id="designation" name="designation" placeholder="Enter your designation"  value="{{ event.designation|default:'' }}" {% if is_readonly %}disabled{% endif %} required>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- UAV Details Card -->
        <div class="card mb-4" id="uavDetails">
            <div class="card-header bg-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-drone me-2"></i>UAV Details and Event Information
                </h5>
            </div>
            <div class="card-body">
                <!-- Incident Details -->
                <h6 class="mb-3 text-primary">Incident Details</h6>
                <div class="row mb-4">
                    <div class="col-md-3">
                        <label for="modelNumber" class="form-label required">Serial Number</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-hashtag"></i></span>
                            <input type="text" class="form-control" id="modelNumber" name="serial_number" placeholder="Enter serial number" required value="{{ event.serial_number|default:'' }}" {% if is_readonly %}disabled{% endif %}>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label for="occurrenceDate" class="form-label required">Date of Occurrence</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-calendar"></i></span>
                            <input type="date" class="form-control" id="occurrenceDate" name="date_of_occurrence" required value="{{ event.date_of_occurrence|date:'Y-m-d'|default:'' }}" {% if is_readonly %}disabled{% endif %}>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label for="occurrenceTime" class="form-label required">Time of Occurrence</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-clock"></i></span>
                            <input type="time" class="form-control" id="occurrenceTime" name="time_of_occurrence" required value="{{ event.time_of_occurrence|time:'H:i'|default:'' }}" {% if is_readonly %}disabled{% endif %}>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label for="fieldSite" class="form-label required">Field/Site</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-map-marker-alt"></i></span>
                            <input type="text" class="form-control required" id="fieldSite" name="field_site" placeholder="Enter location" required value="{{ event.field_site|default:'' }}" {% if is_readonly %}disabled{% endif %}>
                        </div>
                    </div>
                </div>

                <!-- Event Classification -->
                <h6 class="mb-3 text-primary">Event Classification</h6>
                <div class="row mb-4">
                    <div class="col-md-3">
                        <label for="eventType" class="form-label required">Event Type</label>
                        <select class="form-select" id="eventType" name="event_type" required {% if is_readonly %}disabled{% endif %}>
                            <option value="">Select type</option>
                            <option value="accident" {% if event.event_type == "accident" %}selected{% endif %}>Accident</option>
                            <option value="incident" {% if event.event_type == "incident" %}selected{% endif %}>Incident</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="damageLevel" class="form-label required">Damage Level</label>
                        <select class="form-select" id="damageLevel" name="damage_level" required {% if is_readonly %}disabled{% endif %}>
                            <option value="">Select level</option>
                            <option value="Severe" {% if event.damage_level == "Severe" %}selected{% endif %}>Severe</option>
                            <option value="Moderate" {% if event.damage_level == "Moderate" %}selected{% endif %}>Moderate</option>
                            <option value="Minor" {% if event.damage_level == "Minor" %}selected{% endif %}>Minor</option>
                            <option value="none" {% if event.damage_level == "none" %}selected{% endif %}>None</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="flightMode" class="form-label required">Flight Mode</label>
                        <select class="form-select" id="flightMode" name="flight_mode" required {% if is_readonly %}disabled{% endif %}>
                            <option value="">Select mode</option>
                            <option value="takeoff" {% if event.flight_mode == "takeoff" %}selected{% endif %}>Takeoff</option>
                            <option value="stabilize" {% if event.flight_mode == "stabilize" %}selected{% endif %}>Stabilize</option>
                            <option value="manual" {% if event.flight_mode == "manual" %}selected{% endif %}>Manual</option>
                            <option value="fbwa" {% if event.flight_mode == "fbwa" %}selected{% endif %}>FBWA</option>
                            <option value="rtl" {% if event.flight_mode == "rtl" %}selected{% endif %}>RTL</option>
                            <option value="auto" {% if event.flight_mode == "auto" %}selected{% endif %}>Auto</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="eventPhase" class="form-label required">Event Phase</label>
                        <select class="form-select" id="eventPhase" name="event_phase" required {% if is_readonly %}disabled{% endif %}>
                            <option value="">Select phase</option>
                            <option value="maintenance" {% if event.event_phase == "maintenance" %}selected{% endif %}>Maintenance</option>
                            <option value="startup" {% if event.event_phase == "startup" %}selected{% endif %}>Startup</option>
                            <option value="takeoff" {% if event.event_phase == "takeoff" %}selected{% endif %}>Take Off</option>
                            <option value="climb" {% if event.event_phase == "climb" %}selected{% endif %}>Climb</option>
                            <option value="cruise" {% if event.event_phase == "cruise" %}selected{% endif %}>Cruise</option>
                            <option value="descent" {% if event.event_phase == "descent" %}selected{% endif %}>Descent</option>
                            <option value="final" {% if event.event_phase == "final" %}selected{% endif %}>Final Phase</option>
                            <option value="landing" {% if event.event_phase == "landing" %}selected{% endif %}>Landing/Recovery</option>
                        </select>
                    </div>
                </div>

                <!-- UAV Specifications -->
                <h6 class="mb-3 text-primary">UAV Specifications</h6>
                <div class="row mb-4">
                    <div class="col-md-3">
                        <label for="uavSelect" class="form-label required">UAV Type</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-plane"></i></span>
                            <select class="form-select" id="uavSelect" name="uav_type" required {% if is_readonly %}disabled{% endif %}>
                                <option value="">Select type</option>
                                <option value="JF2" {% if event.uav_type == "JF2" %}selected{% endif %}>JF2</option>
                                <option value="JM1" {% if event.uav_type == "JM1" %}selected{% endif %}>JM1</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label for="tailNumber" class="form-label required">Tail Number</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-tag"></i></span>
                            <input type="text" class="form-control" style="text-transform: uppercase;" id="tailNumber" name="tail_number" placeholder="Enter tail number" required value="{{ event.tail_number|default:'' }}" {% if is_readonly %}disabled{% endif %}>
                        </div>
                    </div>
                    <!-- <div class="col-md-3">
                        <label for="gcsType" class="form-label required">GCS Type</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-laptop"></i></span>
                            <input type="text" class="form-control" id="gcsType" name="gcs_type" placeholder="Enter GCS type" required value="{{ event.gcs_type|default:'' }}" {% if is_readonly %}disabled{% endif %}>
                        </div>
                    </div> -->
                    <div class="col-md-3">
                        <label for="gcsNumber" class="form-label required">GCS Number</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-hashtag"></i></span>
                            <input type="text" class="form-control" id="gcsNumber" name="gcs_number" placeholder="Enter GCS number" value="{{ event.gcs_number|default:'' }}" {% if is_readonly %}disabled{% endif %}>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <label for="eventType" class="form-label required">Entry in Logbook</label>
                        <select class="form-select" id="logbookEntry" name="logbook-entry" required {% if is_readonly %}disabled{% endif %}>
                            <option value="">Select type</option>
                            <option value="Yes" {% if event.logbook_entry == "Yes" %}selected{% endif %}>Yes</option>
                            <option value="No" {% if event.logbook_entry == "No" %}selected{% endif %}>No</option>
                        </select>
                    </div>

                </div>

                <div class="row mb-3">
                    <div class="col-md-3">
                        <label for="uavWeight" class="form-label">UAV Weight (kg)</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-weight"></i></span>
                            <input type="number"id="uavWeight"name="uav_weight"class="form-control"placeholder="Enter weight (kg)"step="0.01" min="0" value="{{ event.uav_weight|default:'' }}"{% if is_readonly %}disabled{% endif %}>
                        </div>
                    </div>

                    <!-- Weather Parameters -->
                    <div class="col-md-3">
                        <label for="wind" class="form-label">Wind Speed (knots)</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-wind"></i></span>
                            <input type="number" class="form-control" id="wind" name="wind" placeholder="Enter speed" step="any" value="{{ event.wind|default:'' }}" {% if is_readonly %}disabled{% endif %}>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label for="temperature" class="form-label">Temperature (°C)</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-temperature-high"></i></span>
                            <input type="number" class="form-control" id="temperature" name="temperature" placeholder="Enter temp" value="{{ event.temperature|default:'' }}" {% if is_readonly %}disabled{% endif %}>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label for="pressure" class="form-label">Visibility</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-compress-arrows-alt"></i></span>
                            <input type="number" class="form-control" id="visibility" name="visibility" placeholder="Enter QNH" step="0.01" min="0" value="{{ event.visibility|default:'0' }}" {% if is_readonly %}disabled{% endif %}>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Weather Conditions Card -->
        <div class="card mb-4" id="weatherConditions">
            <div class="card-header bg-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-cloud me-2"></i>Weather Conditions
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-12">
                        <p class="text-muted mb-3">Select all weather conditions that were present during the incident</p>
                        <div class="d-flex flex-wrap gap-4">
                            <div class="form-check">
                                <input class="form-check-input" 
                                    type="checkbox" 
                                    id="rain" 
                                    name="rain"
                                    {% if event.rain %}checked{% endif %}
                                    {% if is_readonly %}disabled{% endif %}>
                                <label class="form-check-label" for="rain">Rain</label>
                            </div>

                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="icing" name="icing" value="true" {% if event.icing %}checked{% endif %} {% if is_readonly %}disabled{% endif %}>
                                <label class="form-check-label" for="icing">
                                    <i class="fas fa-icicles me-2"></i>Icing
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="snow" name="snow" value="true" {% if event.snow %}checked{% endif %} {% if is_readonly %}disabled{% endif %}>
                                <label class="form-check-label" for="snow">
                                    <i class="fas fa-snowflake me-2"></i>Snow
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="turbulence" name="turbulence" value="true" {% if event.turbulence %}checked{% endif %} {% if is_readonly %}disabled{% endif %}>
                                <label class="form-check-label" for="turbulence">
                                    <i class="fas fa-tornado me-2"></i> Turbulence
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="windShear" name="windshear" {% if event.windshear %}checked{% endif %} {% if is_readonly %}disabled{% endif %}>
                                <label class="form-check-label" for="windShear">
                                    <i class="fas fa-arrows-alt-v me-2"></i> Wind Shear
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="moderate" name="moderate" value="true" {% if event.moderate %}checked{% endif %} {% if is_readonly %}disabled{% endif %}>
                                <label class="form-check-label" for="moderate">
                                    <i class="fas fa-wind me-2"></i> Moderate
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="clear" name="clear" value="true" {% if event.clear %}checked{% endif %} {% if is_readonly %}disabled{% endif %}>
                                <label class="form-check-label" for="clear">
                                   <i class="fas fa-sun me-2"></i> Clear
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>


        

        <!-- Description Card -->
        <div class="card mb-4" id="description">
            <div class="card-header bg-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-file-alt me-2"></i>Event Description and Actions
                </h5>
            </div>
            <div class="card-body">
                <div class="mb-4">
                    <label class="form-label">Event Description</label>
                    <textarea class="form-control" name="event_description" rows="3" placeholder="Provide a detailed description of what occurred (e.g., The bird crashed during launch. It reached a height of 10–15 meters before losing stability and stalling to the right.)" {% if is_readonly %}disabled{% endif %}>{{ event.event_description|default:'' }}</textarea>
                </div>

                <div class="mb-4">
                    <label class="form-label">Initial Actions Taken</label>
                    <textarea class="form-control" name="initial_actions_taken" rows="3" placeholder="Describe the immediate actions taken after the incident (e.g., The bird was recovered and damaged parts were assesed.)" {% if is_readonly %}disabled{% endif %}>{{ event.initial_actions_taken|default:'' }}</textarea>
                </div>

                <div class="mb-4">
                    <label class="form-label">Remarks</label>
                    <textarea class="form-control" name="remarks" rows="2" placeholder="Any additional comments or observations..." {% if is_readonly %}disabled{% endif %}>{{ event.remarks|default:'' }}</textarea>
                </div>

                <div class="mb-3">
                    <label class="form-label required">Organization</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-building"></i></span>
                        <input type="text" class="form-control" name="organization" placeholder="Enter your organization name" value="{{ event.organization|default:'' }}" placeholder="name@example.com" required {% if is_readonly %}disabled{% endif %}>
                    </div>
                </div>
            </div>
        </div>

        <!-- File Uploads Card -->
        <div class="card mb-4" id="fileUploads">
            <div class="card-header bg-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-file-upload me-2"></i>Supporting Documents
                </h5>
            </div>
            <div class="card-body">
                <div class="row">

                <!-- Upload inputs (only enabled if not readonly) -->
                {% if not is_readonly %}
                    <div class="col-md-12 mb-4">
                        <label class="form-label d-flex justify-content-between">
                            <span><i class="fas fa-file-video me-2"></i>Video Evidence (Optional)</span>
                            <small class="text-muted">Max size: 100MB</small>
                        </label>
                        <div class="input-group">
                            <input type="file" class="form-control" name="video" accept=".mp4,.avi,.mov" id="videoUpload">
                            <label class="input-group-text" for="videoUpload">Browse</label>
                        </div>
                        <small class="text-muted">Accepted formats: .mp4, .avi, .mov</small>
                    </div>

                    <div class="col-md-12 mb-4">
                        <label class="form-label d-flex justify-content-between">
                            <span><i class="fas fa-images me-2"></i>Photo Evidence (Max 3)</span>
                            <small class="text-muted">Max size: 5MB each</small>
                        </label>
                        <div class="input-group mb-2">
                            <input type="file" class="form-control" name="photo1" accept=".jpg,.jpeg,.png" id="photo1">
                            <label class="input-group-text" for="photo1">Photo 1</label>
                        </div>
                        <div class="input-group mb-2">
                            <input type="file" class="form-control" name="photo2" accept=".jpg,.jpeg,.png" id="photo2">
                            <label class="input-group-text" for="photo2">Photo 2</label>
                        </div>
                        <div class="input-group">
                            <input type="file" class="form-control" name="photo3" accept=".jpg,.jpeg,.png" id="photo3">
                            <label class="input-group-text" for="photo3">Photo 3</label>
                        </div>
                        <small class="text-muted">Accepted formats: .jpg, .jpeg, .png</small>
                    </div>

                    <!-- <div class="col-md-12 mb-3">
                        <label class="form-label d-flex justify-content-between align-items-center">
                            <span>
                                <i class="fas fa-file-alt me-2"></i>
                                Flight Log File
                                <span class="text-danger">*</span>
                            </span>
                            <small class="text-muted">Max size: 10MB</small>
                        </label>

                        <div class="input-group">
                            <input type="file" class="form-control" name="log_file" accept=".txt,.log,.csv" {% if not is_valid %}required{% endif %} id="logFile">
                            <label class="input-group-text" for="logFile">Browse</label>
                        </div>
                        <small class="text-muted">Accepted formats: .txt, .log, .csv</small>
                    </div> -->
                {% endif %}


    <!-- Show uploaded attachments -->
    {% if event %}
        <div class="col-md-12 mt-4">
            <h4>Attachments</h4>
            {% if event.file_video %}
            <p><strong>Video:</strong> 
                <a href="{{ event.file_video.url }}" target="_blank">View Video</a>
            </p>
            {% endif %}

            {% if event.file_image1 %}
            <p><strong>Image 1:</strong> 
                <a href="{{ event.file_image1.url }}" target="_blank">
                <img src="{{ event.file_image1.url }}" alt="Image 1" width="200">
                </a>
            </p>
            {% endif %}

            {% if event.file_image2 %}
            <p><strong>Image 2:</strong> 
                <a href="{{ event.file_image2.url }}" target="_blank">
                <img src="{{ event.file_image2.url }}" alt="Image 2" width="200">
                </a>
            </p>
            {% endif %}

            {% if event.file_image3 %}
            <p><strong>Image 3:</strong> 
                <a href="{{ event.file_image3.url }}" target="_blank">
                <img src="{{ event.file_image3.url }}" alt="Image 3" width="200">
                </a>
            </p>
            {% endif %}

            {% if event.file_log %}
            <!-- <p><strong>Log File:</strong> 
                <a href="{{ event.file_log.url }}" target="_blank">Download Log</a>
            </p> -->
            {% endif %}

            {% if not event.file_video and not event.file_image1 and not event.file_image2 and not event.file_image3 and not event.file_log %}
            <p>No attachments uploaded.</p>
            {% endif %}

        </div>
    {% endif %}
</div>

            </div>
        </div>
                    

        <!-- Submit Button -->
        <div class="card mb-4">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">

                    {% if not is_valid %}
<div class="form-check mb-3">
    <input 
        class="form-check-input"
        type="checkbox"
        id="termsCheckbox"
        onchange="toggleSubmitBtn()"
    >

    <label class="form-check-label" for="termsCheckbox">
        I agree to 
        <span 
            class="text-primary text-decoration-underline"
            style="cursor: pointer;"
            onclick="openTermsModal()"
        >
            Terms & Conditions
        </span>
    </label>
</div>
{% endif %}


                    <!-- Trigger button -->
                    <!-- <button type="button" class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#submitReportModal">
                        <i class="fas fa-save me-2"></i> Submit Report
                    </button> -->

                    <button 
                        type="submit"
                        id="submitBtn"
                        class="btn btn-primary"
                        {% if not is_valid %}disabled{% endif %}
                        {% if is_readonly %}disabled{% endif %}
                    >
                        <i class="fas fa-paper-plane me-2"></i>
                        {% if is_valid %}Update Changes{% else %}Submit Complaint{% endif %}
                    </button>
                </div>
            </div>
        </div>
    </form>
</div>


<!-- terms and condition modal -->
<div class="modal fade" id="termsModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Terms & Conditions</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <div class="border p-3" style="max-height: 300px; overflow-y: auto;">
          <p>
            • All information provided is accurate.<br>
            • False complaints may result in action and your complaint should be deleted.<br>
            • Submitted complaints cannot be edited.<br>
            • Company investigation rules apply.
          </p>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>

    </div>
  </div>
</div>

<!-- terms and condition logic -->
<script>
    function toggleSubmitBtn() {
        const checkbox = document.getElementById("termsCheckbox");
        const submitBtn = document.getElementById("submitBtn");

        if (!checkbox || !submitBtn) return;

        submitBtn.disabled = !checkbox.checked;
    }

    function openTermsModal() {
        const modalEl = document.getElementById("termsModal");
        if (!modalEl) return;

        const modal = new bootstrap.Modal(modalEl);
        modal.show();
    }
</script>



{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Progress bar update
        const formSections = ['pilotInfo', 'uavDetails', 'weatherConditions', 'description','fileUploads'];
        let currentSection = 0;

        const steps = document.querySelectorAll('.step'); // select all steps
        function updateProgress() {
            const progress = ((currentSection + 1) / formSections.length) * 100;
            document.getElementById('formProgress').style.width = progress + '%';

            steps.forEach((step, index) => {
                const stepIcon = step.querySelector('.step-icon');
                if (index <= currentSection) {
                    stepIcon.classList.remove('bg-light');
                    stepIcon.classList.add('bg-primary', 'text-white');
                } else {
                    stepIcon.classList.remove('bg-primary', 'text-white');
                    stepIcon.classList.add('bg-light');
                }
            });
        }

        // Track form filling progress
        const form = document.getElementById('complaintForm');
        const inputs = form.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
    input.addEventListener('change', function() {
        const sectionId = this.closest('.card').id;
        const sectionIndex = formSections.indexOf(sectionId);
        if (sectionIndex > currentSection) {
            currentSection = sectionIndex;
            updateProgress();
        }
    });
});


        // File upload preview
        const fileInputs = document.querySelectorAll('input[type="file"]');
        fileInputs.forEach(input => {
            input.addEventListener('change', function() {
                const label = this.nextElementSibling;
                if (this.files.length > 0) {
                    label.textContent = this.files[0].name;
                }
            });
        });
    });
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const progressBar = document.getElementById('formProgress');
    const steps = document.querySelectorAll('.step-icon');

    {% if is_completed %}
        // Full completion state
        progressBar.style.width = "100%";

        steps.forEach(step => {
            step.classList.remove('bg-light');
            step.classList.add('bg-primary', 'text-white');
        });
    {% endif %}
});
</script>

<!-- Automatically enters the tail number -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    const serialInput = document.getElementById("modelNumber");
    const tailInput = document.getElementById("tailNumber");

    serialInput.addEventListener("input", function () {
        let serialValue = serialInput.value.trim();

        // Example Auto Logic: 
        // Make tail number = "TAIL-" + serial number (customize as needed)
        if (serialValue !== "") {
            tailInput.value = "" + serialValue.toUpperCase();
        } else {
            tailInput.value = "";
        }
    });
});
</script>

{% endblock %}
