
<style>
    .form-label.required::after {
        content: " *";
        color: #dc3545;
    }
</style>
<!-- Product Form Modal -->
<div class="modal fade" id="productFormModal" tabindex="-1" aria-labelledby="productFormLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-white">
                <h5 class="modal-title" id="productFormLabel">
                    <i class="fas fa-box me-2"></i><span id="formTitle">Create New Product</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST" id="productForm" novalidate>
                {% csrf_token %}

                <div class="modal-body">
                    <!-- Product Information Section -->
                    <h6 class="card-title mb-3">
                        <i class="fas fa-box me-2"></i>Product Information
                    </h6>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label required">Tail Number</label>
                            <input type="text" name="tail_number" id="tailNumber" class="form-control" placeholder="e.g., UAV-001" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label required">Model</label>
                            <select name="product_model" id="productModel" class="form-select" required>
                                <option value="">Select model...</option>
                                {% for model in models %}
                                    <option value="{{ model.id }}">{{ model.model_name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label required">Order Name</label>
                            <input type="text" name="order_name" id="orderName" class="form-control" placeholder="e.g., Order-2024" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Manufacturing Date</label>
                            <input type="date" name="manufecturing_Date" id="manufactureDate" class="form-control">
                        </div>
                    </div>

                    <!-- Warranty Information Section -->
                    <h6 class="card-title mb-3">
                        <i class="fas fa-shield-alt me-2"></i>Warranty Information
                    </h6>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Warranty Period (Months)</label>
                            <input type="number" name="warranty_period" id="warrantyPeriod" class="form-control" placeholder="e.g., 24" value="24" min="1">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Product Status</label>
                            <select name="is_sold" id="isSold" class="form-select">
                                <option value="false">Available</option>
                                <option value="true">Sold</option>
                            </select>
                        </div>
                    </div>

                    <!-- Location Information Section -->
                    <h6 class="card-title mb-3">
                        <i class="fas fa-map-marker-alt me-2"></i>Location Information
                    </h6>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Delivery  Location</label>
                            <input type="text" name="delivery_location" id="deliveryLocation" class="form-control" placeholder="Warehouse">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Army Command</label>
                            <input type="text" name="army_command" id="armyCommand" class="form-control" placeholder="Command">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Unit Name</label>
                            <input type="text" name="unit_name" id="unitName" class="form-control" placeholder="Unit-A">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Formation</label>
                            <input type="text" name="formation" id="formation" class="form-control" placeholder="Squadron">
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="submitBtn">Save Product</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {

    const productForm = document.getElementById('productForm');
    const formTitle = document.getElementById('formTitle');
    const submitBtn = document.getElementById('submitBtn');
    const tailNumberField = document.getElementById('tailNumber');
    const modalElement = document.getElementById('productFormModal');
    const modal = bootstrap.Modal.getOrCreateInstance(modalElement);

    // ðŸ”¹ Create Product with confirmation popup
    window.createProduct = function(event) {
    event.preventDefault();

    resetForm();
    formTitle.textContent = 'Create New Product';
    submitBtn.innerHTML = 'Create Product';
    productForm.action = "{% url 'create_product' %}";
    tailNumberField.disabled = false;

    modal.show();
};


    // ðŸ”¹ Edit Product Handler
    const editButtons = document.querySelectorAll('.edit-btn');
    editButtons.forEach(btn => {
        btn.addEventListener('click', function () {

            const id = this.dataset.id;

            formTitle.textContent = 'Edit Product';
            submitBtn.innerHTML = 'Update Product';
            productForm.action = `/product/${id}/edit/`;
            tailNumberField.disabled = true;

            document.getElementById('orderName').value = this.dataset.order || '';
            document.getElementById('deliveryLocation').value = this.dataset.deliveryLocation || '';
            document.getElementById('armyCommand').value = this.dataset.armyCommand || '';
            document.getElementById('unitName').value = this.dataset.unitName || '';
            document.getElementById('tailNumber').value = this.dataset.tailNumber || '';
            document.getElementById('formation').value = this.dataset.formation || '';
            document.getElementById('manufactureDate').value = this.dataset.manufacture || '';
            document.getElementById('productModel').value = this.dataset.model || '';

            modal.show();
        });
    });

    // ðŸ”¹ Form Submit Confirmation
    productForm.addEventListener('submit', function (e) {

        e.preventDefault();   // Stop auto submission

        if (!productForm.checkValidity()) {
            productForm.classList.add('was-validated');
            return;
        }

        openPopup("Are you sure you want to save this product?", function () {
            productForm.submit();
        });
    });

    // ðŸ”¹ Reset function
    function resetForm() {
        productForm.reset();

        document.querySelectorAll('.form-control, .form-select').forEach(field => {
            field.classList.remove('is-invalid', 'is-valid');
        });
    }

});
</script>
